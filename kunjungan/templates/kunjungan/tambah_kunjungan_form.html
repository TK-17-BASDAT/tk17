{% comment %} tk17/kunjungan/templates/kunjungan/tambah_kunjungan_form.html {% endcomment %}

<div class="container mx-auto px-4 py-2">
    <h2 class="text-xl font-semibold text-gray-700 mb-4 pb-2 border-b border-gray-200">
        Tambah Kunjungan Baru
    </h2>

    <form method="post" class="space-y-4" id="tambahKunjunganForm">
        {% csrf_token %}
        
        <!-- ID Klien -->
        <div>
            <label for="klien" class="block text-sm font-medium text-gray-700 mb-1">
                ID Klien yang mendaftarkan pasien <span class="text-red-500">*</span>
            </label>
            <select id="klien" name="klien" required 
                    class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-slate-500 focus:border-slate-500">
                <option value="">Pilih ID Klien</option>
                {% for klien in klien_list %}
                    <option value="{{ klien.no_identitas }}">{{ klien.no_identitas }} - {{ klien.nama_klien }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Email Dokter Hewan -->
        <div>
            <label for="dokter" class="block text-sm font-medium text-gray-700 mb-1">
                Email Dokter Hewan yang akan menangani <span class="text-red-500">*</span>
            </label>
            <select id="dokter" name="dokter" required 
                    class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-slate-500 focus:border-slate-500">
                <option value="">Pilih Dokter Hewan</option>
                {% for dokter in dokter_list %}
                    <option value="{{ dokter.no_dokter_hewan }}">{{ dokter.email_dokter }} - {{ dokter.nama_dokter }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Email Perawat -->
        <div>
            <label for="perawat" class="block text-sm font-medium text-gray-700 mb-1">
                Email Perawat yang akan menanganai <span class="text-red-500">*</span>
            </label>
            <select id="perawat" name="perawat" required 
                    class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-slate-500 focus:border-slate-500">
                <option value="">Pilih Perawat</option>
                {% for perawat in perawat_list %}
                    <option value="{{ perawat.no_perawat_hewan }}">{{ perawat.email_perawat }} - {{ perawat.nama_perawat }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Nama Hewan -->
        <div>
            <label for="nama_hewan" class="block text-sm font-medium text-gray-700 mb-1">
                Nama Hewan yang didaftarkan oleh klien <span class="text-red-500">*</span>
            </label>
            <select id="nama_hewan" name="nama_hewan" required disabled
                    class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-slate-500 focus:border-slate-500 disabled:bg-gray-100">
                <option value="">Pilih klien terlebih dahulu</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">Nama hewan yang tersedia pada dropdown menu adalah hewan yang didaftarkan/dimiliki oleh Klien yang dipilih pada menu sebelumnya (list nama hewan berubah bergantung pada ID Klien yang dipilih)</p>
        </div>

        <!-- Tiga metode kunjungan -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tiga metode kunjungan <span class="text-red-500">*</span></label>
            <div class="space-y-2">
                <label class="flex items-center">
                    <input type="radio" name="tipe_kunjungan" value="Janji Temu" required class="mr-2">
                    <span class="text-sm">Janji Temu (melalui reservasi)</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="tipe_kunjungan" value="Walk-in" required class="mr-2">
                    <span class="text-sm">Walk-in (datang langsung)</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="tipe_kunjungan" value="Darurat" required class="mr-2">
                    <span class="text-sm">Darurat (penanganan segera)</span>
                </label>
            </div>
        </div>

        <!-- Waktu mulai dan akhir -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="waktu_mulai" class="block text-sm font-medium text-gray-700 mb-1">
                    Waktu mulai penanganan <span class="text-red-500">*</span>
                </label>
                <input type="datetime-local" id="waktu_mulai" name="waktu_mulai" required
                       class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-slate-500 focus:border-slate-500">
                <p class="text-xs text-gray-500 mt-1">(terdiri dari tanggal dan jamnya)</p>
            </div>
            <div>
                <label for="waktu_akhir" class="block text-sm font-medium text-gray-700 mb-1">
                    Waktu akhir penanganan
                </label>
                <input type="datetime-local" id="waktu_akhir" name="waktu_akhir"
                       class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-slate-500 focus:border-slate-500">
                <p class="text-xs text-gray-500 mt-1">(opsional, bisa diisi nanti)</p>
            </div>
        </div>

        <div class="flex justify-end pt-4 space-x-2">
            <button type="button" class="modal-close-button-secondary bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm">
                Batal
            </button>
            <button type="submit" class="bg-slate-800 hover:bg-slate-900 text-white px-6 py-2 rounded-md text-sm">
                Simpan Kunjungan
            </button>
        </div>
    </form>
</div>

<script>
// Script untuk mengambil daftar hewan berdasarkan klien yang dipilih
document.getElementById('klien').addEventListener('change', function() {
    const klienId = this.value;
    const hewanSelect = document.getElementById('nama_hewan');
    
    if (klienId) {
        hewanSelect.disabled = true;
        hewanSelect.innerHTML = '<option value="">Loading...</option>';
        
        // Gunakan URL yang sama dengan parameter GET
        fetch(`?klien_id=${klienId}`)
            .then(response => response.json())
            .then(data => {
                hewanSelect.innerHTML = '<option value="">Pilih Hewan</option>';
                data.hewan_list.forEach(hewan => {
                    hewanSelect.innerHTML += `<option value="${hewan.nama}">${hewan.nama}</option>`;
                });
                hewanSelect.disabled = false;
            })
            .catch(error => {
                console.error('Error:', error);
                hewanSelect.innerHTML = '<option value="">Error loading data</option>';
                hewanSelect.disabled = false;
            });
    } else {
        hewanSelect.innerHTML = '<option value="">Pilih klien terlebih dahulu</option>';
        hewanSelect.disabled = true;
    }
});
</script>