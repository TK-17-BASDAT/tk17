{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="flex">
    {% include "navbar/sidebar_frontdesk.html" %}
    <main class="bg-gray-50 flex-1 ml-64 p-6">
        <div class="bg-gray-50 min-h-screen flex items-center justify-center p-6 font-[Poppins]">
            <div class="container mx-auto">
                <div class="flex justify-between items-center mb-6">
                  <h1 class="text-2xl font-semibold">List Jenis Hewan</h1>
                  <button id="btn-create"
                          class="bg-primary text-white px-4 py-2 rounded shadow hover:bg-secondary transition">
                    + Create New Animal Type
                  </button>
                </div>
        
                <table class="w-full table-auto border-collapse">
                  <thead>
                    <tr class="bg-gray-100">
                      <th class="px-4 py-2 border">No</th>
                      <th class="px-4 py-2 border">ID Jenis</th>
                      <th class="px-4 py-2 border">Nama Jenis</th>
                      <th class="px-4 py-2 border">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-b">
                      <td class="px-4 py-2">1</td>
                      <td class="px-4 py-2">HWN001</td>
                      <td class="px-4 py-2">Kucing</td>
                      <td class="px-4 py-2 space-x-2">
                        <button class="btn-update bg-secondary text-white px-3 py-1 rounded text-sm hover:bg-primary transition"
                                data-url="{% url 'jenis_hewan:update' 1 %}">
                          Update
                        </button>
                        <button class="btn-delete bg-accent text-white px-3 py-1 rounded text-sm hover:bg-accent2 transition"
                                data-url="{% url 'jenis_hewan:delete' 1 %}">
                          Delete
                        </button>
                      </td>
                    </tr>
                    <tr class="border-b">
                      <td class="px-4 py-2">2</td>
                      <td class="px-4 py-2">HWN002</td>
                      <td class="px-4 py-2">Anjing</td>
                      <td class="px-4 py-2 space-x-2">
                        <button class="btn-update bg-secondary text-white px-3 py-1 rounded text-sm hover:bg-primary transition"
                                data-url="{% url 'jenis_hewan:update' 2 %}">
                          Update
                        </button>
                        <button class="btn-delete bg-accent text-white px-3 py-1 rounded text-sm hover:bg-accent2 transition"
                                data-url="{% url 'jenis_hewan:delete' 2 %}">
                          Delete
                        </button>
                      </td>
                    </tr>
                    <tr class="border-b">
                      <td class="px-4 py-2">3</td>
                      <td class="px-4 py-2">HWN003</td>
                      <td class="px-4 py-2">Hamster</td>
                      <td class="px-4 py-2 space-x-2">
                        <button class="btn-update bg-secondary text-white px-3 py-1 rounded text-sm hover:bg-primary transition"
                                data-url="{% url 'jenis_hewan:update' 3 %}">
                          Update
                        </button>
                        <button class="btn-delete bg-accent text-white px-3 py-1 rounded text-sm hover:bg-accent2 transition"
                                data-url="{% url 'jenis_hewan:delete' 3 %}">
                          Delete
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
        
              <!-- Modal -->
              <div id="modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden">
                <div id="modal-content" class="bg-white rounded-lg shadow-xl w-1/3 p-6"></div>
              </div>
        
              <script>
              document.addEventListener('DOMContentLoaded', () => {
                const modal = document.getElementById('modal'),
                      content = document.getElementById('modal-content');
        
                function openModal(html){
                  content.innerHTML = html;
                  modal.classList.remove('hidden');
                }
                function closeModal(){
                  modal.classList.add('hidden');
                  content.innerHTML = '';
                }
        
                // Create
                document.getElementById('btn-create')
                  .addEventListener('click', ()=>
                    fetch("{% url 'jenis_hewan:create' %}")
                      .then(r=>r.text()).then(openModal)
                  );
        
                // Update & Delete buttons
                document.querySelectorAll('.btn-update').forEach(btn=>{
                  btn.onclick = ()=> fetch(btn.dataset.url)
                    .then(r=>r.text()).then(openModal);
                });
                document.querySelectorAll('.btn-delete').forEach(btn=>{
                  btn.onclick = ()=> fetch(btn.dataset.url)
                    .then(r=>r.text()).then(openModal);
                });
        
                // Handle form submissions via AJAX
                modal.addEventListener('submit', e=>{
                  e.preventDefault();
                  const form = e.target,
                        data = new FormData(form);
                  fetch(form.action, {
                    method: form.method,
                    headers: {'X-Requested-With':'XMLHttpRequest'},
                    body: data
                  })
                  .then(r=>r.json())
                  .then(json=>{
                    if(json.success){
                      location.reload();
                    } else {
                      content.innerHTML = json.html;
                    }
                  });
                });
        
                // Close on cancel or clickâ€outside
                modal.addEventListener('click', e=>{
                  if(e.target===modal || e.target.classList.contains('btn-cancel')){
                    closeModal();
                  }
                });
              });
              </script>
        </div>
    </main>
</div>

{% endblock %}
